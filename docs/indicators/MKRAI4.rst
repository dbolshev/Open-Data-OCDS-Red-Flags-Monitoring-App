###############################################################################################
MKRAI4. Прямое заключение договора по коду ОКГЗ, по которому ранее был отменен лот или конкурс. 
###############################################################################################

***************
Суть индикатора
***************

Индикатор отслеживает случаи, когда закупающая организация закупает методом прямого заключения договора предмет закупки, по которому только что отменила конкурсные закупки.

****
Риск
****

Возможное уклонение от конкурсных закупок, сговор представителей закупающей организации и участника.  


*******************************
Нарушение норм/принципов закона
*******************************

Возможное нарушение основных принципов осуществения госзакупок, описанных в статье 1 Закона "О государственных закупках".

***********************************
Основание для разработки индикатора
***********************************

Индикатор вводится, так как в системе не реализован контроль за историей закупок закупающей организации.

******************************
Методология расчета индикатора
******************************

Уровень расчета
===============
Индикатор рассчитывается на уровне *конкурса*.

Источники данных для расчета
============================

Для расчета индикатора используются следующие источники данных:

- API системы государственных закупок в OCDS формате.
- Аналитическая таблица :ref:`tbl_CPVCancelled`.
- Транзакционная переменная :ref:`tv_tenderCPVList`.

Типы закупок
============

Индикатор рассчитывается для следующих типов конкурсов:

- метод прямого заключения договора.


Статусы закупки
---------------

Индикатор рассчитывается для конкурсов, которые:

- находятся в статусе ``published``
- находятся в статусе ``changed``.


Частота расчета
===============

Если выполнены все условия для активации расчета индикатора, он рассчитывается каждый раз после изменений в JSON-документе конкурса. Также индикатор расчитывается один раз в сутки, если выполнены все условия для его расчета.

Поля для расчета
================

Для расчета индикатора используются следующие поля API модуля системы гос. закупок:

- ``data.parties.id``
- ``data.parties.roles``
- ``data.datePublished``

Для расчета используется следующая аналитическая таблица:

- :ref:`tbl_CPVCancelled`

Для расчета используется следующая транзакционная переменная:

- :ref:`tv_tenderCPVList`


Формула расчета
===============

1. Определяем идентификатор закупающей организации  ``data.parties.id``, у которого ``data.parties.roles='procuringEntity'``.

2. Определяем дату публикации закупки на портале ``data.datePublished``.

3. Выбираем все идентификаторы предметов закупки из переменной :ref:`tv_tenderCPVList`.

4. Для каждого кода предмета закупки из п.3 и идентификатора закупающей организации из п.1 ищем строку в аналитической таблице :ref:`tbl_CPVCancelled`

5. Если хоть для одного кода предмета закупки найдена строка в таблице и дата из п.2 отличается от даты в строке аналитической страницы на 5 или меньше дней, индикатор принимает значение ``1``, расчет заканчивается.

6. Если мы дошли до этого пункта, индикатор принимает значение ``0``.


Факторы, которые влияют на корректное срабатывание индикатора
=============================================================

Индикатор может срабатывать неправильно, если представитель закупающей организации неправильно определил код предмета закупки.
