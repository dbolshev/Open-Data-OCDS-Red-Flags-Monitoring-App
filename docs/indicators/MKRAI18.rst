######################################################################################################################################################
MKRAI18. Применение закупки методом прямого заключения договора с одним и тем же поставщиком по причине приобретения товаров, работ и услуг по каждой статье расходов один раз в год до минимальной пороговой суммы, используя похожие статьи ОКГЗ.
######################################################################################################################################################

***************
Суть индикатора
***************

Индикатор отслеживает случаи, когда закупающая организация практикует дробление, маскируя один предмет закупки под разными похожими кодами закупок.

****
Риск
****

Избегание применения конкурсных процедур с целью заключения договора с "удобным" поставщиком путем изменения формы закупки, но не по сути. 


*******************************
Нарушение норм/принципов закона
*******************************

Статья 21. П.4. Закупающая организация вправе самостоятельно провести закупки методом прямого заключения договора в случаях: 3) приобретения товаров, работ и услуг по каждой статье расходов один раз в год до минимальной пороговой суммы.


***********************************
Основание для разработки индикатора
***********************************

Индикатор вводится для выявления возможного дробления предмета закупки закупающей организацией.

******************************
Методология расчета индикатора
******************************

Уровень расчета
===============
Индикатор рассчитывается на уровне *конкурса*.

Источники данных для расчета
============================

Для расчета индикатора используются следующие источники данных:

- API системы государственных закупок в OCDS формате
- Аналитическая таблица :ref:`tbl_CPVOneSupplier`
- Транзакционная переменная :ref:`tv_tenderCPV`

Типы процедур
=============

Индикатор рассчитывается для следующих типов процедур:

- метод прямого заключения договора.


Статусы процедур
----------------

Индикатор рассчитывается для конкурсов, которые начаты в текущем году (``data.tender.datePublished``) и находятся в статусах:

- находятся в статусе ``evaluationComplete``
- находятся в статусе ``contractSignPending``

Частота расчета
===============

Если выполнены все условия для активации расчета индикатор, он рассчитывается один раз.

Качество данных
===============

Если выполнены все условия для активации расчета индикатора, он рассчитывается каждый раз после изменений в JSON-документе конкурса. Также индикатор расчитывается один раз в сутки, если выполнены все условия для его расчета.


Поля для расчета
================

Для расчета индикатора используются следующие поля API модуля системы гос. закупок:

- ``data.tender.procurementMethodRationale``
- ``data.parties.roles``
- ``data.parties.identifier.scheme``
- ``data.parties.identifier.id``
- ``data.tender.datePublished``
- ``data.tender.date``
- ``data.awards.status``
- ``data.awards.relatedBid``
- ``data.bids.details.priceProposal.relatedItem``
- ``data.bids.details.priceProposal.unit.value.amount``
- ``data.bids.tenderers.id``
- ``data.tender.bids.id``
- ``data.tender.items.id``
- ``data.tender.items.quantity``
- ``data.tender.items.classification.id``
- ``data.tender.items.classification.scheme``

Формула расчета
===============

1. Выбираем только те процедуры, у которых ``data.tender.procurementMethodRationale = 'annualProcurement'``. И только процедуры на поставку товаров.
3. Находим идентификатор закупающей организации (конкатенация ``data.parties.identifier.scheme`` и ``data.parties.identifier.id``), такой, что ``data.parties.roles = 'buyer, procuringEntity'``.
4. Определяем дату объявления процедуры ``data.tender.datePublished``.
5. Выбираем все объекты определения победителя, которые имеют ``data.awards.status = 'active'``.
6. Выбираем ценовое предложение, которое победило в определении победителя ``data.bids.id = data.awards.relatedBid``.
7. В ценовом предложении находим идентификатор предметов закупки ``data.bids.details.priceProposal.relatedItem`` и стоимости единиц предметов закупки ``data.bids.details.priceProposal.unit.value.amount``.
8. По идентификатору предмета закупки находим позицию в тендерном объявлении ``data.bids.details.priceProposal.relatedItem = data.tender.items.id``.
9. Из позиции в тендерном предложении находим код предмета закупки (конкатенация ``data.tender.items.classification.scheme`` и ``data.tender.items.classification.id``) а также количество закупаемых единиц ``data.tender.items.quantity`` и идентификатор поставщика ``data.bids.tenderers.id``.
10. Находим категорию для предмета закупки - первые 6 знаков в коде CPV.
11. Находим сумму по предмету закупки: количество ``data.tender.items.quantity`` умножаем на стоимость ``data.bids.details.priceProposal.unit.value.amount``.
12. Имея идентификатор закупающей организации, идентификатор поставщика, категорию предмета закупки, сумму закупки и дату оглашения процедуры, можем перейти к сравнению с данными аналитической таблицы.
13. Находим в аналитической таблице все строки, где первые 3 значения равны нашим из пункта 12, а дата ``data.tender.date`` из нашей процедуры больше, чем дата в строке аналитической таблицы.
14. Складываем суммы из найденных строк из аналитической таблицы и сумму из пункта 10. Если результат больше пороговой суммы (1000000 сом), индикатор принимает значение ``1``, расчет заканчивается.
15. Если мы дошли до этого пункта, индикатор принимает значение ``0``.


Факторы, которые влияют на корректное срабатывание индикатора
=============================================================

Индикатор может срабатывать неправильно, если закупающая организация не отображает на портале все фактически пройденные этапы процедуры закупки.
Также индикатор может срабатывать неправильно в связи с определением порогов для закупающей организации в связи с данными по размеру ее уставного капитала.
