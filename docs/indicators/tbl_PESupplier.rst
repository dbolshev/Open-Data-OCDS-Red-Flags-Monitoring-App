.. _tbl_PESupplier:

tbl_PESupplier
==============

Данная аналитическая таблица хранит все факты победы поставщика в процедурах закупающих организаций.

Данная аналитическая таблица содержит следующую информацию:
 - Идентификатор поставщика.
 - Идентификатор закупающей организации.
 - Дату завершения процедуры.
 
Пример того, как может выглядеть таблица:

========================== ====================================== ======
Идентификатор поставщика   Идентификатор закупающей организации   Дата
-------------------------- -------------------------------------- ------
Идентификатор поставщика 1 Идентификатор закупающей организации 1 Дата 1
Идентификатор поставщика 1 Идентификатор закупающей организации 2 Дата 2
Идентификатор поставщика 1 Идентификатор закупающей организации 3 Дата 3
Идентификатор поставщика 2 Идентификатор закупающей организации 4 Дата 4
Идентификатор поставщика 2 Идентификатор закупающей организации 5 Дата 5
...                        ...
========================== ====================================== ======

****************************
Расчет аналитической таблицы
****************************

****************************
Источники данных для расчета
****************************

Для расчета аналитической таблицы используются следующие источники данных:

- API системы государственных закупок в OCDS формате.

*************************************
Частота расчета аналитической таблицы
*************************************

Аналитическая таблица рассчитывается 1 раз в сутки.

****************
Поля для расчета
****************

- ``data.parties.id``
- ``data.parties.identifier.scheme``
- ``data.parties.identifier.id``
- ``data.parties.roles``
- ``data.tender.date``

***********************
Формула расчета таблицы
***********************

1. Перед расчетом таблица очищается.
2. Выбираем только процедуры, у которых ``data.tender.procurementMethodDetails`` принимает одно из значений: ``oneStage``, ``simplicated``, ``downgrade``.
3. Выбираем только завершенные процедуры ``data.tender.status = 'complete'`` или те, что находятся в статусе ``data.tender.status = 'active'``, но имеют ``statusDetails = 'evaluationComplete'`` более 30 дней.
4. В исследуемой процедуре выбираем всех поставщиков-победителей, таких ``data.parties``, у которых ``data.parties.roles = 'supplier'``.
5. Выбираем их идентификаторы - конкатенация ``data.parties.identifier.scheme`` и ``data.parties.identifier.id``.
6. Выбираем идентификатор закупающей организации (конкатенация ``data.parties.identifier.scheme`` и ``data.parties.identifier.id``), такой, для которого ``data.parties.roles = 'buyer, procuringEntity'``.
7. Выбираем дату завершения процедуры ``data.tender.date``.
8. Полученные результаты записываем в таблицу.
